# Sprint Input Format Guide

> `sprint-input.md` is the **Sprint SSOT file** generated by Phase 0 (Smart Launcher).
> It analyzes user originals (brief.md + reference materials) and produces structured input for the Auto Sprint Pipeline.

---

## File Location

```
specs/{feature}/inputs/sprint-input.md
```

- Located in the `inputs/` directory alongside user original files
- Auto-generated by Phase 0 (user editing prohibited)
- Referenced by all downstream agents in Auto Sprint

---

## YAML Frontmatter

```yaml
---
feature: {feature-name}
generated_at: {ISO 8601}
generated_by: sprint-onboarding-phase-0
brief_grade: A | B | C
goals:
  - {goal_1}
  - {goal_2}
  - {goal_3}
complexity: simple | medium | complex
brief_sentences:
  - id: BRIEF-1
    text: "{Brief sentence 1}"
  - id: BRIEF-2
    text: "{Brief sentence 2}"
causal_chain:
  phenomenon: "{text}"
  phenomenon_source: "{filename | inferred_from_brief | user_confirmed}"
  phenomenon_evidence: "{relevant passage or location in the document}"
  root_cause: "{text}"
  root_cause_source: "{filename | inferred_from_brief | user_confirmed}"
  root_cause_evidence: "{relevant passage or location in the document}"
  solution_rationale: "{text}"
  rationale_source: "{filename | inferred_from_brief | user_confirmed}"
  rationale_evidence: "{relevant passage or location in the document}"
  feature_request: "{text}"
  feature_source: "brief"
  chain_status: complete | partial | feature_only
time_estimate:
  initial_range: "{N}~{M}min"
input_files:
  - name: brief.md
    type: core-brief
    lines: {N}
  - name: meeting-notes.md
    type: reference
    category: meeting-notes
    lines: {N}
    relevance: high
brownfield_status: greenfield | configured | partial-failure | local-only
brownfield_topology: standalone | co-located | msa | monorepo
document_project_path: "{path or null}"
document_project_status: fresh | stale | expired | null
fallback_tier: 1 | 2 | 3
validation:
  brief_included: true
  references_processed: 3/3
  discovered_requirements: 7
  goals_mapped: 3/3
  contradictions_detected: 1
tracking_source: brief | success-criteria
external_resources:
  external_repos:
    - name: "{repo-name}"
      path: "{accessible local path}"
      access_method: "add-dir"
  figma:
    - file_key: "{fileKey}"
      source_file: "brief.md"
    status: configured | not-configured
flags:
  force_jp1_review: false  # true for Grade C Briefs
---
```

### Frontmatter Field Descriptions

| Field | Required | Description |
|-------|----------|-------------|
| `feature` | Y | Feature name (kebab-case) |
| `generated_at` | Y | Generation timestamp (ISO 8601) |
| `generated_by` | Y | `sprint-onboarding-phase-0` (Sprint route) or `specs-direct` (Direct route) |
| `brief_grade` | Y | Brief quality grade (A/B/C) |
| `goals` | Y | 3-5 extracted goals |
| `complexity` | Y | Complexity classification (simple/medium/complex) |
| `input_files` | Y | List of processed input files |
| `brownfield_status` | Y | Brownfield source status (`local-only`: co-located code only, no MCP/document-project) |
| `brownfield_topology` | Y | Detected deployment topology (`standalone`/`co-located`/`msa`/`monorepo`) |
| `document_project_path` | N | Path to document-project output (null if absent) |
| `document_project_status` | N | document-project freshness (`fresh`/`stale`/`expired`/`null`) |
| `fallback_tier` | Y | Analysis success level (1=rich, 2=minimal, 3=Brief only) |
| `validation` | Y | Self-check results (`discovered_requirements` = count of Discovered Requirements) |
| `brief_sentences` | Y | Brief sentence decomposition (id: BRIEF-N, text: original sentence). Used for PRD FR source tagging |
| `causal_chain` | N | Causal chain 4 layers + source/evidence + chain_status. Optional — may be empty when feature_only and user did not opt in |
| `causal_chain.chain_status` | (Y if causal_chain exists) | `complete` (all confirmed), `partial` (some inferred), `feature_only` (user chose not to add) |
| `time_estimate` | Y | Complexity-based initial time range |
| `tracking_source` | Y | Brief tracking source. `brief`: BRIEF-N based (Sprint route), `success-criteria`: PRD Success Criteria based (Guided/Direct route) |
| `flags.force_jp1_review` | Y | Whether to force JP1 review |
| `external_resources` | N | External resource references auto-detected from inputs and environment |
| `external_resources.external_repos` | N | External repo paths detected via `--add-dir` or other access methods |
| `external_resources.external_repos[].name` | (Y if external_repos exists) | Repo identifier (derived from directory name) |
| `external_resources.external_repos[].path` | (Y if external_repos exists) | Accessible local path to the repo |
| `external_resources.external_repos[].access_method` | (Y if external_repos exists) | How the path was provided (`add-dir`) |
| `external_resources.figma` | N | Figma design file references |
| `external_resources.figma[].file_key` | (Y if figma exists) | Figma fileKey extracted from URL |
| `external_resources.figma[].source_file` | (Y if figma exists) | File where URL was detected |
| `external_resources.figma.status` | (Y if figma exists) | `configured` (MCP connected) or `not-configured` (MCP unavailable) |

---

## Body Sections

### Core Brief (required)

```markdown
## Core Brief

{Full text of brief.md — preserved verbatim, never modified}
```

- Include the entire content of brief.md **verbatim**
- No summarizing, editing, or restructuring
- Referenced by all BMad agents in Auto Sprint

### Reference Materials (optional)

```markdown
## Reference Materials

### {filename-1}
- **Category**: {meeting-notes | customer-data | analysis-report | wireframe | other}
- **Relevance**: {high | medium | low}
- **Key Points**:
  - {key point 1}
  - {key point 2}
- **Constraints**: {constraints}
- **Decisions**: {decisions}
```

- Files under 200 lines: include in full
- Files over 200 lines: summarize (extract Key Points, Constraints, Decisions)
- Image files (PNG, JPG): include filename + description text only
- PDF: process first 100 pages only

### Discovered Requirements (optional)

```markdown
## Discovered Requirements

### Found in Reference Materials (evidence-backed)
- [DISC-01] {content} (source: {filename}, evidence: "{relevant passage}")

### Added by AI Inference (requires user confirmation)
- [DISC-02] {content} (inferred_reason: "{AI reasoning basis}")
```

- Requirements discovered in reference materials but absent from Brief
- **Source classification**: Explicitly distinguish "found in reference materials" vs "AI inference". Shown separately at JP1
- 5 or fewer: include all (default: included in Sprint scope)
- More than 5: include top 3 only, tag remainder as "next Sprint candidates"

### Detected Contradictions (optional)

```markdown
## Detected Contradictions

| # | Brief Says | Reference Says | Source | Status |
|---|-----------|---------------|--------|--------|
| 1 | {A} | {B} | meeting.md | unresolved |
```

- Omit section if no contradictions found
- MVP: detect only, no auto-resolution
- Shown as a caution when prompting "Start Sprint?"

### Brownfield Status (optional)

```markdown
## Brownfield Status

| Source | Type | Status | Notes |
|--------|------|--------|-------|
| {source} | mcp / document-project / local-codebase | ok / error / not-configured | {details} |
```

- Brownfield source access results based on Kit Onboarding state
- `greenfield`: No sources (section may be omitted)
- `configured`: All sources healthy
- `partial-failure`: Some sources failed
- `local-only`: Co-located code only (no MCP/document-project)

---

## Brief Quality Grade Criteria

| Grade | Condition | Phase 0 Behavior |
|-------|-----------|------------------|
| **A** (sufficient) | 3+ features mentioned, 1+ scenarios mentioned, or references compensate | Normal proceed |
| **B** (moderate) | 1-2 features mentioned, no scenarios | Show warning at "Start Sprint?" prompt |
| **C** (insufficient) | 0 features, keywords only | Offer "Sprint not recommended" option; if proceeding, set `force_jp1_review: true` |

---

## Fallback Tier Definition

| Tier | Condition | sprint-input.md Content |
|------|-----------|------------------------|
| **1** | Full analysis successful | Core Brief + Reference + Insights + Contradictions |
| **2** | Only brief.md analyzable (reference failure) | Core Brief only |
| **3** | Inline Brief only (brief.md auto-generated) | Brief text only |
| **4** | Cannot comprehend | Sprint aborted (sprint-input.md not generated) |

---

## Defense Limits

| Item | Limit |
|------|-------|
| Max file count | 20 |
| Max total size | 50MB |
| PDF max pages | 100 pages (excess ignored) |
| Supported formats | `*.md`, `*.txt`, `*.pdf`, `*.png`, `*.jpg`, `*.jpeg`, `*.yaml`, `*.json`, `*.csv` |
| Unsupported formats | Warn + skip |
| On limit exceeded | Show warning + prioritize most recently modified files |

---

## Examples

### Example 1: Full (Tier 1, Grade A, with references)

```yaml
---
feature: tutor-exclusion
generated_at: 2026-02-13T10:30:00+09:00
generated_by: sprint-onboarding-phase-0
brief_grade: A
goals:
  - "Implement post-lesson tutor exclusion feature"
  - "Filter excluded tutors from matching pool"
  - "Provide exclusion management UI"
complexity: medium
causal_chain:
  phenomenon: "Persistent complaints about tutors after lessons with no resolution mechanism"
  phenomenon_source: "cs-report.md"
  phenomenon_evidence: "Increasing trend of tutor-related complaints over the past 3 months"
  root_cause: "Matching system does not reflect negative experiences, causing repeated matching with same tutor"
  root_cause_source: "inferred_from_brief"
  root_cause_evidence: "Excluded tutors should be removed from future matching → inferred absence of current exclusion mechanism"
  solution_rationale: "Allow students to exclude specific tutors from matching pool to prevent repeat negative experiences"
  rationale_source: "brief"
  rationale_evidence: "Please create a feature that lets students block specific tutors"
  feature_request: "Post-lesson tutor exclusion + matching filter + exclusion management UI"
  feature_source: "brief"
  chain_status: complete
time_estimate:
  initial_range: "60~120min"
input_files:
  - name: brief.md
    type: core-brief
    lines: 25
  - name: cs-report.md
    type: reference
    category: customer-data
    lines: 150
    relevance: high
  - name: competitor-analysis.md
    type: reference
    category: analysis-report
    lines: 80
    relevance: medium
brownfield_status: configured
brownfield_topology: standalone
document_project_path: null
document_project_status: null
fallback_tier: 1
validation:
  brief_included: true
  references_processed: 2/2
  discovered_requirements: 4
  goals_mapped: 3/3
  contradictions_detected: 0
tracking_source: brief
external_resources:
  figma:
    - file_key: "abc123def456"
      source_file: "brief.md"
    status: configured
flags:
  force_jp1_review: false
---

# Sprint Input: tutor-exclusion

## Core Brief

Please create a feature that lets students block specific tutors after lessons, linked to a post-lesson rating system.
Excluded tutors should be removed from future matching.
...

## Reference Materials

### cs-report.md
- **Category**: customer-data
- **Relevance**: high
- **Key Points**:
  - Increasing trend of tutor-related complaints over the past 3 months
  - Main complaints: lesson attitude, time non-compliance
- **Constraints**: Exclusion is student → tutor direction only
- **Decisions**: None

### competitor-analysis.md
- **Category**: analysis-report
- **Relevance**: medium
- **Key Points**:
  - Competitor A: exclusion + reason selection
  - Competitor B: exclusion + unblock feature
- **Constraints**: None
- **Decisions**: None

## Discovered Requirements

- [DISC-01] Exclusion reason selection UI needed (source: competitor-analysis.md)
- [DISC-02] Unblock feature needed (source: competitor-analysis.md)

## Brownfield Status

| Source | Type | Status | Notes |
|--------|------|--------|-------|
| backend-docs | mcp | ok | API docs accessible |
| client-docs | mcp | ok | Client docs accessible |
| svc-map | mcp | ok | Service map accessible |
| figma | mcp | ok | Figma board accessible |
```

### Example 2: Minimal (Tier 3, Inline Brief, Grade B)

```yaml
---
feature: quick-feature
generated_at: 2026-02-13T15:00:00+09:00
generated_by: sprint-onboarding-phase-0
brief_grade: B
goals:
  - "Implement tutor exclusion feature"
complexity: simple
causal_chain:
  phenomenon: ""
  phenomenon_source: ""
  phenomenon_evidence: ""
  root_cause: ""
  root_cause_source: ""
  root_cause_evidence: ""
  solution_rationale: ""
  rationale_source: ""
  rationale_evidence: ""
  feature_request: "Implement tutor exclusion feature"
  feature_source: "brief"
  chain_status: feature_only
time_estimate:
  initial_range: "30~60min"
input_files:
  - name: brief.md
    type: core-brief
    lines: 1
brownfield_status: greenfield
brownfield_topology: standalone
document_project_path: null
document_project_status: null
fallback_tier: 3
validation:
  brief_included: true
  references_processed: 0/0
  discovered_requirements: 0
  goals_mapped: 1/1
  contradictions_detected: 0
tracking_source: brief
flags:
  force_jp1_review: false
---

# Sprint Input: quick-feature

## Core Brief

Build a tutor exclusion feature
```

### Example 3: Grade C Brief + contradiction detected + force_jp1_review

```yaml
---
feature: tutor-feedback
generated_at: 2026-02-13T16:00:00+09:00
generated_by: sprint-onboarding-phase-0
brief_grade: C
goals:
  - "Implement lesson feedback system"
complexity: simple
causal_chain:
  phenomenon: "No post-lesson feedback collection channel, insufficient data for service improvement"
  phenomenon_source: "inferred_from_brief"
  phenomenon_evidence: "Inferred from Brief 'feedback' keyword + meeting notes 'post-lesson star rating feature request'"
  root_cause: "Absence of structured lesson quality evaluation system"
  root_cause_source: "inferred_from_brief"
  root_cause_evidence: "Inferred from star rating + text comment request indicating no current evaluation system"
  solution_rationale: "Systematically collect lesson quality data through star rating + text-based feedback system"
  rationale_source: "inferred_from_brief"
  rationale_evidence: "Inferred from meeting notes '5-star rating + text comment'"
  feature_request: "Implement lesson feedback system"
  feature_source: "brief"
  chain_status: partial
time_estimate:
  initial_range: "30~60min"
input_files:
  - name: brief.md
    type: core-brief
    lines: 2
  - name: meeting-notes.md
    type: reference
    category: meeting-notes
    lines: 45
    relevance: high
brownfield_status: greenfield
brownfield_topology: standalone
document_project_path: null
document_project_status: null
fallback_tier: 2
validation:
  brief_included: true
  references_processed: 1/1
  discovered_requirements: 2
  goals_mapped: 1/1
  contradictions_detected: 1
tracking_source: brief
flags:
  force_jp1_review: true
---

# Sprint Input: tutor-feedback

## Core Brief

feedback

## Reference Materials

### meeting-notes.md
- **Category**: meeting-notes
- **Relevance**: high
- **Key Points**:
  - Post-lesson star rating feature request
  - 5-star rating + text comment
- **Constraints**: Anonymous to tutors
- **Decisions**: Auto-alert when rating ≤ 3 stars

## Discovered Requirements

- [DISC-01] Star rating UI needed (source: meeting-notes.md)
- [DISC-02] Tutor anonymization logic needed (source: meeting-notes.md)

## Detected Contradictions

| # | Brief Says | Reference Says | Source | Status |
|---|-----------|---------------|--------|--------|
| 1 | (feature not mentioned) | 5-star rating + text comment | meeting-notes.md | unresolved |
```

### Example 4: specs-direct (Direct route, after BMad artifacts complete)

```yaml
---
feature: tutor-exclusion
generated_at: 2026-02-13T18:00:00+09:00
generated_by: specs-direct
brief_grade: A
goals:
  - "Implement post-lesson tutor exclusion feature"
  - "Filter excluded tutors from matching pool"
  - "Provide exclusion management UI"
brief_sentences: []
causal_chain: null
time_estimate:
  initial_range: "60~120min"
input_files: []
brownfield_status: configured
brownfield_topology: standalone
document_project_path: null
document_project_status: null
fallback_tier: 1
validation:
  brief_included: false
  references_processed: 0/0
  discovered_requirements: 0
  goals_mapped: 3/3
  contradictions_detected: 0
tracking_source: success-criteria
flags:
  force_jp1_review: false
---
```

- **Direct route**: Auto-generated by `/specs` when BMad 12-step planning-artifacts already exist
- `generated_by: specs-direct` — Phase 0 bypassed
- `brief_sentences: []` — Uses PRD Success Criteria tracking instead of Brief sentence tracking
- `tracking_source: success-criteria` — JP1 maps against PRD Measurable Outcomes
- `causal_chain: null` — Causal chain not generated in Direct route
